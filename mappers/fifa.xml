<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FIFA">


<!-- 	Image Convert	 -->

	<select id="image_convert" parameterType="map" resultType="_byte[]">
	
		SELECT
			img
		FROM
			Image
		WHERE
			img_no =
			
			<if test="no != null">
			
				#{no}
			
			</if>
			<if test="role != null">
			
				(
					SELECT
						<choose>
							<when test="role == 'Club'">
								emblem
							</when>
							<when test="role == 'Stadium'">
								std_img
							</when>
							<otherwise>
								profile
							</otherwise>
						</choose>
					FROM
						${role}
					WHERE
						<choose>
							<when test="role == 'Stadium'">
								std_name
							</when>
							<otherwise>
								name
							</otherwise>
						</choose>
						= #{name}
				)
				
			</if>
	
	</select>
	
	
<!-- 	Login	 -->

	<select id="login" parameterType="String" resultType="map">
	
		SELECT
			*
		FROM
			FIFA
		WHERE
			id = #{id}
			
	</select>
	
	
<!-- 	Join	 -->

	<insert id="join" parameterType="map">
	
		INSERT
			INTO FIFA (
				id,
				pw,
				name,
				role
			)
			VALUES (
				#{id},
				#{pw},
				#{name},
				#{role}
			);
			
		<if test="role == 'Club'">
		
			INSERT
				INTO Stadium (
					std_name
				)
				VALUES (
					#{stadium}
				);
			INSERT
				INTO Club (
					name,
					country,
					stadium
				)
				VALUES (
					#{name},
					#{country},
					#{stadium}
				);
		
		</if>
		<if test="role == 'Manager'">
		
			INSERT
				INTO Manager (
					name,
					country,
					birth,
					height,
					weight,
					ovr,
					tactic
				)
				VALUES (
					#{name},
					#{country},
					#{birth},
					#{height},
					#{weight},
					#{ovr},
					#{tactic}
				);
			
		</if>
		<if test="role == 'Player'">
		
			INSERT
				INTO Player (
					name,
					country,
					birth,
					height,
					weight,
					ovr,
					position
				)
				VALUES (
					#{name},
					#{country},
					#{birth},
					#{height},
					#{weight},
					#{ovr},
					#{position}
				);
		
		</if>
		<if test="img != null">
			
			INSERT
				INTO Image (
					img
				)
				VALUES (
					#{img}
				);
			UPDATE
				${role}
			SET
				<choose>
					<when test="role == 'Club'">
						emblem
					</when>
					<otherwise>
						profile
					</otherwise>
				</choose>
				= LAST_INSERT_ID()
			WHERE
				name = #{name};
				
		</if>
		<if test="img1 != null">
			
			INSERT
				INTO Image (
					img
				)
				VALUES (
					#{img1}
				);
			UPDATE
				Stadium
			SET
				std_img = LAST_INSERT_ID()
			WHERE
				std_name = #{stadium};
			
		</if>
	</insert>
	
	
<!--	 FIFA Award		-->
	
	<select id="award" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			Season
		LEFT
			JOIN ${role}
			ON ${award} = name
		WHERE
			season = #{season}
			
	</select>
	
	
<!--	 FIFA Award Ballon Dor		-->
	
	<select id="award_ballondor" parameterType="map" resultType="map">
	
		SELECT
			*, 'Player' role, 'ballondor' award
		FROM
			Season
		LEFT
			JOIN Player
			ON ballondor = name
		WHERE
			season = #{season}
			
	</select>
	
	
<!--	 FIFA Award Goal Scorer		-->
	
	<select id="award_goalScorer" parameterType="map" resultType="map">
	
		SELECT
			*, 'Player' role, 'goalScorer' award
		FROM
			Season
		LEFT
			JOIN Player
			ON goalScorer = name
		WHERE
			season = #{season}
			
	</select>
	
	
<!--	 FIFA Award Assist Provider		-->
	
	<select id="award_assistProvider" parameterType="map" resultType="map">
	
		SELECT
			*, 'Player' role, 'assistProvider' award
		FROM
			Season
		LEFT
			JOIN Player
			ON assistProvider = name
		WHERE
			season = #{season}
			
	</select>
	
	
<!--	 FIFA Award List		-->
	
	<select id="award_list" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			Season
		LEFT
			JOIN ${role}
			ON ${award} = name
		ORDER BY
			season DESC
			
	</select>
	
	
<!--	 FIFA Award Odds		-->
	
	<select id="award_odds" parameterType="map" resultType="map">
	
		SELECT
			MAX(win) win, MAX(draw) draw, MAX(lose) lose,
			MAX(win) / MAX(game) winodds, MAX(draw) / MAX(game) drawodds, MAX(lose) / MAX(game) loseodds
		FROM
			Ranking
		WHERE
			season	= #{season} AND
		    club	= #{club}
		GROUP BY
			season, club
			
	</select>
	
	
<!--	 FIFA Award Score		-->
	
	<select id="award_score" parameterType="map" resultType="map">
	
		SELECT
			*, COUNT(round) countround, AVG(rating) avgrating, SUM(goal) sumgoal, SUM(assist) sumassist
		FROM
			Score
		WHERE
			season	= #{season}	AND
		    player	= #{name}
		GROUP BY
			season, player
			
	</select>
	
	
<!--	 FIFA List		-->
	
	<select id="list" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			${role}
			
			<if test="role == null">
			
				Club
				
			</if>
			
		ORDER BY
			ovr DESC
			
	</select>
	
	
<!--	 Roster list		-->
	
	<select id="roster_list" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			Club
		WHERE
		
			<if test="name == null">
			
				roster = 1
				
			</if>
			<if test="name != null">
			
				name = #{name}
				
			</if>
			
		ORDER BY
			ovr DESC
			
	</select>
	
	
<!-- 	Info Club	 -->

	<select id="info_club" parameterType="String" resultType="map">
	
		SELECT
			*
		FROM
			Club
		WHERE
			name = #{name}
			
	</select>
	
	
<!-- 	Info Manager	 -->

	<select id="info_manager" parameterType="String" resultType="map">
	
		SELECT
			*
		FROM
			Manager
		WHERE
			name = #{name}
			
	</select>
	
	
<!-- 	Info Player	 -->

	<select id="info_player" parameterType="String" resultType="map">
	
		SELECT
			p.*,po.*
		FROM
			Player p
		LEFT JOIN Position po
			ON p.position = po.position
		WHERE
			p.name = #{name}
	
	</select>
	
	
</mapper>