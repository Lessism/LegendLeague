<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FIFA">


<!-- 	Image Convert	 -->

	<select id="image_convert" parameterType="map" resultType="_byte[]">
	
		SELECT
			img
		FROM
			Image
		WHERE
			img_no =
			
			<if test="no != null">
			
				#{no}
			
			</if>
			<if test="role != null">
			
				(
					SELECT
						<choose>
							<when test="role == 'Club'">
								emblem
							</when>
							<otherwise>
								profile
							</otherwise>
						</choose>
					FROM
						${role}
					WHERE
						name = #{name}
				)
				
			</if>
	
	</select>
	
	
<!-- 	Login	 -->

	<select id="login" parameterType="String" resultType="map">
	
		SELECT
			*
		FROM
			FIFA
		WHERE
			id = #{id}
			
	</select>
	
	
<!-- 	Join	 -->

	<insert id="join" parameterType="map">
	
		INSERT
			INTO FIFA (
				id,
				pw,
				name,
				role
			)
			VALUES (
				#{id},
				#{pw},
				#{name},
				#{role}
			);
			
		<if test="role == 'Club'">
		
			INSERT
				INTO Stadium (
					std_name
				)
				VALUES (
					#{stadium}
				);
			INSERT
				INTO Club (
					name,
					country,
					stadium
				)
				VALUES (
					#{name},
					#{country},
					#{stadium}
				);
		
		</if>
		<if test="role == 'Manager'">
		
			INSERT
				INTO Manager (
					name,
					country,
					birth,
					height,
					weight,
					ovr,
					tactic
				)
				VALUES (
					#{name},
					#{country},
					#{birth},
					#{height},
					#{weight},
					#{ovr},
					#{tactic}
				);
			
		</if>
		<if test="role == 'Player'">
		
			INSERT
				INTO Player (
					name,
					country,
					birth,
					height,
					weight,
					ovr,
					position
				)
				VALUES (
					#{name},
					#{country},
					#{birth},
					#{height},
					#{weight},
					#{ovr},
					#{position}
				);
		
		</if>
		<if test="img != null">
			
			INSERT
				INTO Image (
					img
				)
				VALUES (
					#{img}
				);
			UPDATE
				${role}
			SET
				<choose>
					<when test="role == 'Club'">
						emblem
					</when>
					<otherwise>
						profile
					</otherwise>
				</choose>
				= LAST_INSERT_ID()
			WHERE
				name = #{name};
				
		</if>
		<if test="img1 != null">
			
			INSERT
				INTO Image (
					img
				)
				VALUES (
					#{img1}
				);
			UPDATE
				Stadium
			SET
				std_img = LAST_INSERT_ID()
			WHERE
				std_name = #{stadium};
			
		</if>
	</insert>
	
	
<!--	 FIFA List		-->
	
	<select id="list" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			${role}
			
			<if test="role == null">
			
				Club
				
			</if>
			
		ORDER BY
			ovr DESC
			
	</select>
	
	
<!--	 Roster list		-->
	
	<select id="roster_list" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			Club
		WHERE
		
			<if test="name == null">
			
				roster = 1
				
			</if>
			<if test="name != null">
			
				name = #{name}
				
			</if>
			
		ORDER BY
			ovr DESC
			
	</select>
	
	
<!-- 	리그 로스터	 -->

	<select id="infoleague" resultType="map">
	
		SELECT
			*
		FROM
			League
	
	</select>
	
	
<!-- 	로스터 등록	 -->

	<update id="updateroster" parameterType="String">
	
		UPDATE
			League
		SET
			roster = #{rosterlist}
		WHERE
			name = 'Legend League'
		
	</update>
	
	
<!-- 	클럽 정보	 -->

	<select id="infoclub" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			Club
		WHERE
			name = #{name}
			
	</select>
	
	
<!-- 	감독 정보	 -->

	<select id="infomanager" parameterType="map" resultType="map">
	
		SELECT
			name,
			country,
			birth,
			height,
			weight,
			ovr,
			tactic
		FROM
			Manager
		WHERE
			name = #{name}
			
	</select>
	
	
<!-- 	선수 정보	 -->

	<select id="infoplayer" parameterType="map" resultType="map">
	
		SELECT
			*
		FROM
			Player
		WHERE
			name = #{name}
			
	</select>
	
	
</mapper>